<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8" />
		<title>My Quiz</title>
    <script src="/public/third/jquery-2.1.1.min.js"></script>
    <script src="/public/third/jquery.cookie.js"></script>
    <meta name="viewport" content="width=device-width, user-scalable=no" >
	</head>
<body>

<style type="text/css">
body {
  margin: 0 auto;
  font-size: 18pt;
}
</style>

<table cellspacing="0" id="header">
  <td id="left"><img src="/public/img/icon/menu.png" height="40"></td>
  <td id="center">My Quiz</td>
</table>
<table id="drawer" cellspacing="1" boroder="0">
  <tr><td><a href="/generate/" style="text-decoration:none;">Generate</a></td></tr>
  <tr><td><a href="/myquestion/" style="text-decoration:none;">My Quiz</a></td></tr>
  <tr><td><a href="/myanswer/" style="text-decoration:none;">My Answer</a></td></tr>
  <tr><td><a href="/other/" style="text-decoration:none;">Other</a></td></tr>
  <tr><td><a href="/news/" style="text-decoration:none;">News</a></td></tr>
  <tr><td><a href="/contact/" style="text-decoration:none;">Contact</a></td></tr>
  <tr><td><a href="/rule/" style="text-decoration:none;">Rule</a></td></tr>
</table>

<script>
$(function(){
  var width = $(window).width();
  var drawerIsOpen = false;
  $('#left').click(function(){
    if(drawerIsOpen){
      $('#drawer').css({
        'left': -width
      });
      drawerIsOpen = false;
    }else{
      $('#drawer').css({
        'left': 0
      });
      drawerIsOpen = true;
    }
  });
  $('#drawer').css({
    'width': width * 80/100,
    'overflow': 'scroll',
    'display': 'block',
    'position': 'absolute',
    'z-index': 10,
    'margin': 0,
    'top': 50,
    'left': -width
  });
  $('#drawer td').css({
    'width': width * 80/100,
    'height': 50,
    'background-color': '#996666'
  });
  $('#header').css({
    'background-color': '#996666',
    'height': 50
  });
  
  $('#left').css({
    'width': $(window).width() / 4,
    'text-align': 'center',
  });
  
  $('#center').css({
    'width': ($(window).width() * 3/4) -2,
    'text-align': 'center'
  });
});

</script>

<table id="cel" cellspacing="1" boroder="0">
</table>

<script>

var width = $(window).width();
var celLength = width -50;
var endNum = 0;
var addLimit = 20;
var celNum = 0;
var resData = '';
function addCel(resData){
  console.log(resData);
  var celImg = '/public/img/icon/no_image.jpg';
  var cellTxt = '';
  while(celNum < addLimit){
    cellId = resData[celNum][0];
    cellTxt = resData[celNum][1];
    if(resData[celNum][2]){
      celImg = resData[celNum][2];
    }
    var append = 
    '<tr><td>'+
    '<a href="/quiz/?q='+cellId+'" style="text-decoration:none;color:black;">'+
    '</a><img src="'+celImg+'" style="width:48px;height:48px;vertical-align:middle;">'+
    '</td><td style="background-color:#e0ffff;height:50px;width:'+celLength+'px;">'+
    '<a href="/quiz/?q='+cellId+'" style="text-decoration:none;color:black;">'+cellTxt+'</a>'+
    '</td></tr>';
    $('#cel').append(append);
    ++celNum;
//     celTop = celTop + 40;
    if(!resData[celNum]){
      return;
    }
  }
}

function getData(first){
  var param = {
    endNum : endNum
  };
  $.get('/myquestionshow/',param,function(res){
//     resData = id, txt, img
    if(res[0]==1){
      resData = $.merge($.merge([], resData), res[1]);
      endNum = res[1].pop()[0];
//       console.log(endNum);
      if(first == 1){
        addCel(resData);
      }
    }else if(res[0]==2){
//      console.log('no data from API');
    }
  }, "json");
}

var dataLimit = 80;
$(function(){
  getData(1);
//   addCel();
//   var detect = $(window).height();
  var detect = 300;
	$(window).scroll(function(){
		var scrTop = $(document).scrollTop();
		if(scrTop > detect){
//       detect = detect + $(window).height();
      detect = detect + 300;
      addLimit = addLimit + 20;
      if(addLimit > dataLimit){
        dataLimit = dataLimit + 80;
        getData();
      }
      if(resData[celNum]){
//         console.log('add cel');
        addCel(resData);
      }
    }
	});
});

// 
// $(function(){
//   var width = $(window).width();
//   $('.question').css({
//     'height': 40,
//     'width': width -40,
//     'font-size': '18pt'
//   });
//   $('.quiz_photo').css({
//     'height': 40,
//     'width': 40,
//     'font-size': '18pt'
//   });
// });

</script>

</body>
</html>
