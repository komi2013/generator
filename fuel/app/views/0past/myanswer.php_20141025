<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8" />
		<title>My Quiz</title>
    <script src="/public/third/jquery-2.1.1.min.js"></script>
    <script src="/public/third/jquery.cookie.js"></script>
    <meta name="viewport" content="width=device-width, user-scalable=no" >
	</head>
<body>

<style type="text/css">
body {
  margin: 0 auto;
  font-size: 18pt;
}
</style>

<table cellspacing="0" id="header">
  <td id="left"><img src="/public/img/icon/menu.png" height="40"></td>
  <td id="center">My Quiz</td>
</table>
<table id="drawer" cellspacing="1" boroder="0">
  <tr><td><a href="/myquestion/">My Quiz</a></td></tr>
  <tr><td><a href="/myanswer/">My Answer</a></td></tr>
  <tr><td><a href="/other/">Other</a></td></tr>
  <tr><td><a href="/news/">News</a></td></tr>
  <tr><td><a href="/contact/">Contact</a></td></tr>
  <tr><td><a href="/rule/">Rule</a></td></tr>
</table>

<script>
$(function(){
  var width = $(window).width();
  var drawerIsOpen = false;
  $('#left').click(function(){
    if(drawerIsOpen){
      $('#drawer').css({
        'left': -width
      });
      drawerIsOpen = false;
    }else{
      $('#drawer').css({
        'left': 0
      });
      drawerIsOpen = true;
    }
  });
  $('#drawer').css({
    'width': width * 80/100,
    'overflow': 'scroll',
    'display': 'block',
    'position': 'absolute',
    'z-index': 10,
    'margin': 0,
    'top': 50,
    'left': -width
  });
  $('#drawer td').css({
    'width': width * 80/100,
    'height': 50,
    'background-color': '#996666'
  });
  $('#header').css({
    'background-color': '#996666',
    'height': 50
  });
  
  $('#left').css({
    'width': $(window).width() / 4,
    'text-align': 'center',
  });
  
  $('#center').css({
    'width': ($(window).width() 3/4) -2,
    'text-align': 'center'
  });
});

</script>

<table id="cel" cellspacing="1" boroder="0">
<?php if(isset($question)){ foreach($question as $k => $d){ ?>
  <tr><td><a href="/quiz/?q=<?=$d->id?>"><?=Str::truncate($d->txt, 20)?></a></td></tr>
<?php }} ?>
</table>


<script>

var width = $(window).width();
var celLength = width * 1/2;
var celTop = 40;
var celLeft = 0;

var endNum = 0;
var addLimit = 20;
// var addAmount = addLimit;
var celNum = 0;
var resData = '';
function addCel(resData){
// console.log(resData);
//       $record_arr = array();
//       $record_arr[] = $d->id;
//       $record_arr[] = $d->comment;
//       $record_arr[] = $d->path;
//       $record_arr[] = $d->price;
//       $record_arr[] = $d->u_id;
//       $dt_nail_arr[] = $record_arr;
var celImg = '/public/img/icon/no_image.jpg';
var likeImg0 = '/public/img/icon/like0.png';
var likeImg1 = '/public/img/icon/like1.png';
var cellTxt = '0';
var likeTop = celTop+celLength-30;
var likeLeft = celLeft+celLength-30;
if(localStorage['nailLike']){
  var nailLike = JSON.parse(localStorage['nailLike']);
}else{
  var nailLike = Array();
} 


  while(celNum < addLimit){
    celImg = resData[celNum][2];
    cellId = resData[celNum][0];
    cellUid = resData[celNum][4];
    cellTxt = resData[celNum][1];
    likeTop = celTop+celLength-40;
    likeLeft = celLeft+celLength-40; 
    $('#cel').append($('<a href="/watch/nail/'+cellId+'/'+cellUid+'/"><img src="'+celImg+'" style="position:absolute;top:'+celTop+'px;left:'+celLeft+'px;width:'+celLength+'px;height:'+celLength+'px;"></a>'));
//     $('#cel').append($('<img src="'+likeImg+'" id="like'+cellId+'" class="like" style="position:absolute;top:'+likeTop+'px;left:'+likeLeft+'px;width:30px;height:30px;z-index:3">'));
//    arrayObj.indexOf(value)
    if(nailLike.indexOf(cellId) < 0){
      $('#cel').append($('<img src="'+likeImg0+'" id="like'+cellId+'" onclick="like(this)" style="position:absolute;top:'+likeTop+'px;left:'+likeLeft+'px;width:30px;height:30px;z-index:3">'));
    }else{
      $('#cel').append($('<img src="'+likeImg1+'" id="like'+cellId+'" onclick="like(this)" style="position:absolute;top:'+likeTop+'px;left:'+likeLeft+'px;width:30px;height:30px;z-index:3">'));
    }

//     $('#cel').append($('<a href="/watch/nail/'+celNum+'" style="position:absolute;top:'+editTop+'px;left:'+editLeft+'px;width:30px;height:30px;z-index:2"></a>'));
    $('#cel').append($('<div style="position:absolute;top:'+celTop+'px;left:'+celLeft+'px;width:'+celLength+'px;height:20px;z-index:2">'+cellTxt+'</div>'));
    cellTxt = celNum;
    ++celNum;
    if(celNum%2==1){
      celLeft = celLeft + celLength;
    }else{
      celLeft = 0;
      celTop = celTop + celLength
    }
    if(!resData[celNum]){
//       console.log('when no more data at all');
      return;
    }
  }
}

function getData(first){
  var url1 = '/look/newnail4/';
  var param = {
    endNum : endNum
  };
  $.get(url1,param,function(res){
//     resData = res;
    if(res[0][0]==1){
      endNum = res[1].pop()[0];
//       console.log(endNum);
      resData = $.merge($.merge([], resData), res[1]);
  //     console.log(resData);
      if(first == 1){
        addCel(resData);
      }
    }else if(res[0][0]==2){
//      console.log('no data from API');
    }
  }, "json");
}

var dataLimit = 80;
$(function(){
  getData(1);
//   addCel();
//   var detect = $(window).height();
  var detect = 300;
	$(window).scroll(function(){
		var scrTop = $(document).scrollTop();
		if(scrTop > detect){
//       detect = detect + $(window).height();
      detect = detect + 300;
      addLimit = addLimit + 20;
      if(addLimit > dataLimit){
        dataLimit = dataLimit + 80;
        getData();
      }
      if(resData[celNum]){
//         console.log('add cel');
        addCel(resData);
      }
    }
	});
});

function like(argThis){
//   console.log(argThis);
  
  if(localStorage['nailLike']){
    var nailLike = JSON.parse(localStorage['nailLike']);
  }else{
    var nailLike = Array();
  } 
//   var nailId = likeNail.indexOf(argThis.id.slice(4));
  console.log(argThis.id.slice(4));
  var nailId = argThis.id.slice(4);
  if($(argThis).attr("src") == '/public/img/icon/like0.png'){

    var url1 = '/look/naillikeadd/';
    var param = {
      nailId : nailId
    };
    $.post(url1,param,function(res){
      if(res[0][0]==1){
        $(argThis).attr("src", '/public/img/icon/like1.png');
        nailLike.push(nailId);
        localStorage['nailLike'] = JSON.stringify(nailLike);
      }else{
        console.log(res);
      }
    }, "json")  
  }else{
    var url1 = '/look/naillikedel/';
    var param = {
      nailId : nailId
    };
    $.post(url1,param,function(res){
      if(res[0][0]==1){
        $(argThis).attr("src", '/public/img/icon/like0.png');
        var arrPosition = nailLike.indexOf(nailId);
        nailLike.splice(arrPosition,1);
        localStorage['nailLike'] = JSON.stringify(nailLike);
      }else{
       console.log(res);
      }
    }, "json")  
  }
}

// $('.like').live("click", function(){
//   console.log('click');
// //   $('#like'+id).slideUp();
//   $('#like'+this.id).attr("src", '/public/img/icon/like1.png');
// });


</script>

</body>
</html>
