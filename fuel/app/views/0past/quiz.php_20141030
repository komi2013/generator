<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8" />
		<title><?=Str::truncate($q_txt, 30)?></title>
    <script src="/public/third/jquery-2.1.1.min.js"></script>
    <script src="/public/third/jquery.cookie.js"></script>
    <meta name="viewport" content="width=device-width, user-scalable=no" >
	</head>
<body>

<style type="text/css">
body {
  margin: 0 auto;
  font-size: 18pt;
}
</style>

<table cellspacing="0" id="header">
  <td id="left"><img src="/public/img/icon/menu.png" height="40"></td>
  <td id="center">Quiz Generator</td>
  <td id="right"></td>
</table>
<table id="drawer" cellspacing="1" boroder="0">
  <tr><td><a href="/generate/" style="text-decoration:none;">Generate</a></td></tr>
  <tr><td><a href="/myprofile/" style="text-decoration:none;">Profile</a></td></tr>
  <tr><td><a href="/myanswer/" style="text-decoration:none;">My Answer</a></td></tr>
  <tr><td><a href="/other/" style="text-decoration:none;">Other</a></td></tr>
  <tr><td><a href="/follow/" style="text-decoration:none;">Follow</a></td></tr>
  <tr><td><a href="/news/" style="text-decoration:none;">News</a></td></tr>
  <tr><td><a href="/contact/" style="text-decoration:none;">Contact</a></td></tr>
  <tr><td><a href="/rule/" style="text-decoration:none;">Rule</a></td></tr>
</table>
<script>
$(function(){
  var width = $(window).width();
  var drawerIsOpen = false;
  $('#left').click(function(){
    if(drawerIsOpen){
      $('#drawer').css({
        'left': -width
      });
      drawerIsOpen = false;
    }else{
      $('#drawer').css({
        'left': 0
      });
      drawerIsOpen = true;
    }
  });
  $('#drawer').css({
    'width': width * 80/100,
    'overflow': 'scroll',
    'display': 'block',
    'position': 'absolute',
    'z-index': 10,
    'margin': 0,
    'top': 50,
    'left': -width,
    'background-color': 'white'
  });
  $('#drawer td').css({
    'width': width * 80/100,
    'height': 50,
    'background-color': '#996666'
  });
  $('#header').css({
    'background-color': '#996666',
    'height': 50
  });
  
  $('#left').css({
    'width': $(window).width() / 4,
    'text-align': 'center',
  });
  
  $('#center').css({
    'width': ($(window).width() * 2/4) -2,
    'text-align': 'center'
  });
  $('#right').css({
    'width': $(window).width() / 4,
    'text-align': 'center',
  });

});

</script>
<?php if($img){?>
<img src="<?=$img?>" id="photo">
<br>
<?php } ?>
<div id="question"><?=$q_txt?></div>

<table cellspacing="1" boroder="0">
  <tr><td class="choice" id="choice_0"><?=$arr_choice[0]?></td><td id="response_0"></td><td style="display:none;" class="td_position">0</td></tr>
  <tr><td class="choice" id="choice_1"><?=$arr_choice[1]?></td><td id="response_1"></td><td style="display:none;" class="td_position">1</td></tr>
  <tr><td class="choice" id="choice_2"><?=$arr_choice[2]?></td><td id="response_2"></td><td style="display:none;" class="td_position">2</td></tr>
  <tr><td class="choice" id="choice_3"><?=$arr_choice[3]?></td><td id="response_3"></td><td style="display:none;" class="td_position">3</td></tr>
</table>
<table id="cel_1" cellspacing="1" boroder="0"></table>
<table id="cel_2" cellspacing="1" boroder="0"></table>
<table cellspacing="1" boroder="0">
<tr>
  <td><img src="/public/img/icon/no_image.jpg" class="icon"></td>
  <td class="num_txt" id="num_ratio">0 % </td>
  <td><img src="/public/img/icon/no_image.jpg" class="icon"></td>
  <td class="num_txt" id="num_answer">0</td>
</tr>
</table>

<table cellspacing="1" boroder="0">
<tr>
<td>
  <a href="http://www.facebook.com/sharer.php?u=http://<?=Config::get('my.domain')?>/quiz/?q=<?=$question?>">
    <img src="https://www.facebookbrand.com/img/assets/asset.f.logo.lg.png" class="icon">
  </a>
</td>
<td class="num_txt" id="num_ratio">
  <a href="https://twitter.com/share?http://<?=Config::get('my.domain')?>/quiz/?q=<?=$question?>&text=<?=Str::truncate($q_txt, 30)?>">
  TW
  </a>
</td>
<td class="num_txt" id="num_ratio">
  <a href="line://msg/text/?<?=Str::truncate($q_txt, 30)?>%0D%0Ahttp://<?=Config::get('my.domain')?>/quiz/?q=<?=$question?>">
  LINE
  </a>
</td>
</tr>
</table>


<script>
var already = 1;
var width = $(window).width();
var correct = '<?=$correct?>';
var q_num = '<?=$question?>';
var user = '<?=$user?>';
getData();

if(localStorage.answer){
  var answer = JSON.parse(localStorage.answer);
}else{
  var answer = [];
}

$(function(){
  $('#question').css({
    'height': 85,
    'width': width * 98/100,
    'font-size': '18pt'
  });
  
  $('.choice').css({
    'height': 50,
    'width': width -2,
    'font-size': '18pt',
    'background-color': '#E0FFFF'
  });
  $('#photo').css({
    'width': width,
    'height': width
  });

  // "[["569","wiwi"],["569","wiwi"],["569","mimi"]]"
  var already_answer = '';
  for(i = 0; i < answer.length; i++){
  //   document.write(answer[i] + '<br>');
    if(answer[i][0] == q_num){
      already = 2;
      already_answer = answer[i][1];
    }
  }
  if(already == 2){
    $('.choice').each(function(i){
      if(correct == $('#choice_'+i).html()){
//         console.log('lime');
        $('#choice_'+i).css({
          'background-color': 'lime'
        });
        if(already_answer == $('#choice_'+i).html()){
          $('#response_'+i).append('O');
        }

      }else{
        $('#choice_'+i).css({
          'background-color': 'grey'
        });
        if(already_answer == $('#choice_'+i).html()){
          $('#response_'+i).append('X');
        }
      }
//       console.log(already_answer);
//       console.log($('#choice_'+i).html());
    });    
  }

});

$('.choice').click(function(){
  if(already == 2){
    return;
  }
  var td_position = $(this).siblings('.td_position').html(); 
  
  if(correct == $(this).html()){
    $('#response_'+td_position).append('O');
    var correct_answer = 1;  
  }else{
    $('#response_'+td_position).append('X');
    var correct_answer = 2; 
  }
  $('.choice').each(function(i){
    if(correct == $('#choice_'+i).html()){
      $('#choice_'+i).css({
        'background-color': 'lime'
      });
    }else{
      $('#choice_'+i).css({
        'background-color': 'grey'
      });
    }
  });    
  var param = {
    correct : correct_answer,
    question : q_num,
    user : user
  };
  $.post('/answer/',param,function(res){
    if(res[0]==1){
      //rest_job callback correct for security 
    }else{
    }
  }, "json");
  already = 2;
  answer[answer.length] = [q_num,$(this).html(),correct_answer];
  localStorage.answer = JSON.stringify(answer);
  //rest_job limit 100 
});

// var celLength = width -50;
// var endNum = 0;
// var addLimit = 20;

var resData = '';
function addCel(resData,correct){
  console.log(resData);
  var celImg = '/public/img/icon/no_image.jpg';
  var cellTxt = '';
//   var celNum = 0;
//   var addLimit = 15;
  var append = 
  '<tr><td rowspan="2"><img src="/public/img/icon/no_image.jpg" style="width:48px;height:48px;vertical-align:middle;"></td>';
//   $('#cel_'+correct).append(append);

//   while(celNum < addLimit){
//   console.log(celNum.length);
  for (var celNum=0;celNum<resData.length;celNum++){
    cellId = resData[celNum][0];
    cellTxt = resData[celNum][1];
    celImg = resData[celNum][2];
//     if(resData[celNum][2]){
//       
//     }
    append = append + 
    '<td>'+
    '<a href="/profile/?u='+cellId+'" style="text-decoration:none;color:black;">'+
    '<img src="'+celImg+'" style="width:48px;height:48px;vertical-align:middle;"></a>'+
    '</td>';
//     $('#cel_'+correct).append(append);
    if(celNum == 6){
      append = append + '</tr><tr>';
//       $('#cel_'+correct).append('</tr><tr>');
    }
//     ++celNum;
//     if(!resData[celNum]){
//       return;
//     }
  }
  $('#cel_'+correct).append(append);
  $('#cel_'+correct).append('</tr>');
}

function getData(){
  var param = {
    q : q_num,
    u : user
  };
  var append = '';
  $.get('/quizusershow/',param,function(res){
//     resData = id, txt, img
    if(res[0]==1){
//       resData = $.merge($.merge([], resData), res[1]);
//       endNum = res[1].pop()[0];
//       console.log(endNum);
//       if(first == 1){
//         addUser(res[1]);

      append = 
      '<a href="/profile/?u='+res[1][0]+'">'+
      '<img src="'+res[1][2]+'" style="height:48px;vertical-align:middle;"></a>';
      $('#right').append(append);


      addCel(res[2],'1');
      addCel(res[3],'2');
//       }
    }else{
     console.log(res);
    }
  }, "json");
}
    
</script>

</body>
</html>
